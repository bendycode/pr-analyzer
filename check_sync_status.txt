# Commands to check repository sync status

# 1. Check the repository sync status and progress
heroku run rails console
# Then in console:
repo = Repository.find_by(name: 'PureOxygen/u-app')
puts "Repository: #{repo.name}"
puts "Sync Status: #{repo.sync_status}"
puts "Sync Progress: #{repo.sync_progress} PRs processed"
puts "Total PRs: #{repo.pull_requests.count}"
puts "PRs with ready_for_review_at: #{repo.pull_requests.where.not(ready_for_review_at: nil).count}"
puts "Total Weeks: #{repo.weeks.count}"
puts "Last fetched: #{repo.last_fetched_at}"
exit

# 2. Check if week generation is needed
heroku run rake weeks:generate

# 3. Update week statistics
heroku run rake weeks:update_stats

# 4. Check Sidekiq for active/pending jobs
# In the Sidekiq web UI (/sidekiq), look for:
# - Active jobs in the "Busy" tab
# - Queued jobs in the "Queues" tab
# - Failed jobs in the "Retries" or "Dead" tabs

# 5. Check recent logs for errors
heroku logs --tail -n 100 | grep -i error

# 6. Force week regeneration for this repository (if needed)
heroku run rails console
# Then:
repo = Repository.find_by(name: 'PureOxygen/u-app')
repo.pull_requests.find_each { |pr| pr.update_week_associations }
WeekStatsService.new(repo).update_all_weeks
exit